---
layout: post
title: "rustæ–‡ä»¶æ“ä½œ"
date:   2025-09-24
tags: [rust]
comments: true
author: VR2050
toc: true
---


## rustæ–‡ä»¶æ“ä½œéšç¬”


####  æ•°æ®ç±»å‹



> æœ¬æ–‡ **ä»…ä½¿ç”¨ Rust æ ‡å‡†åº“**ï¼Œæ·±å…¥è§£ææ–‡ä»¶ç³»ç»Ÿæ“ä½œä¸­æ¶‰åŠçš„æ‰€æœ‰æ ¸å¿ƒæ•°æ®ç±»å‹ï¼Œä¸å¼•å…¥ä»»ä½•å¤–éƒ¨ crateã€‚

***

## ğŸ“š ç›®å½•

- [rustæ–‡ä»¶æ“ä½œéšç¬”](#rustæ–‡ä»¶æ“ä½œéšç¬”)
    - [æ•°æ®ç±»å‹](#æ•°æ®ç±»å‹)
- [ğŸ“š ç›®å½•](#-ç›®å½•)
- [1. `std::fs` æ¨¡å—æ¦‚è§ˆ](#1-stdfs-æ¨¡å—æ¦‚è§ˆ)
- [2. `Path` ä¸ `PathBuf`](#2-path-ä¸-pathbuf)
  - [âœ… `Path` â€”â€” ä¸å¯å˜è·¯å¾„å¼•ç”¨](#-path--ä¸å¯å˜è·¯å¾„å¼•ç”¨)
  - [âœ… `PathBuf` â€”â€” å¯å˜è·¯å¾„ï¼ˆæ‹¥æœ‰æ‰€æœ‰æƒï¼‰](#-pathbuf--å¯å˜è·¯å¾„æ‹¥æœ‰æ‰€æœ‰æƒ)
  - [âœ… åˆ›å»ºæ–¹å¼](#-åˆ›å»ºæ–¹å¼)
  - [âœ… æ ¸å¿ƒæ–¹æ³•](#-æ ¸å¿ƒæ–¹æ³•)
  - [âœ… è·¨å¹³å°è¯´æ˜](#-è·¨å¹³å°è¯´æ˜)
- [3. `DirEntry`](#3-direntry)
  - [âœ… æ ¸å¿ƒæ–¹æ³•](#-æ ¸å¿ƒæ–¹æ³•-1)
- [4. `Metadata`](#4-metadata)
  - [âœ… æ ¸å¿ƒæ–¹æ³•](#-æ ¸å¿ƒæ–¹æ³•-2)
- [5. `FileType`](#5-filetype)
  - [âœ… æ ¸å¿ƒæ–¹æ³•](#-æ ¸å¿ƒæ–¹æ³•-3)
- [6. `Permissions`](#6-permissions)
  - [âœ… ä¿®æ”¹æƒé™ï¼ˆä»… Unixï¼‰](#-ä¿®æ”¹æƒé™ä»…-unix)
- [7. `File`](#7-file)
  - [âœ… å®ç°çš„ Trait](#-å®ç°çš„-trait)
- [8. `OpenOptions`](#8-openoptions)
  - [âœ… å¸¸ç”¨é…ç½®](#-å¸¸ç”¨é…ç½®)
- [9. `Read` / `Write` / `Seek` Traits](#9-read--write--seek-traits)
  - [âœ… `Read`](#-read)
    - [å¸¸ç”¨æ–¹æ³•](#å¸¸ç”¨æ–¹æ³•)
  - [âœ… `Write`](#-write)
    - [å¸¸ç”¨æ–¹æ³•](#å¸¸ç”¨æ–¹æ³•-1)
  - [âœ… `Seek`](#-seek)
- [10. `BufReader` / `BufWriter`](#10-bufreader--bufwriter)
  - [âœ… ä¼˜åŠ¿](#-ä¼˜åŠ¿)
- [11. `Stdio` ç›¸å…³ç±»å‹](#11-stdio-ç›¸å…³ç±»å‹)
  - [âœ… ä½¿ç”¨ç¤ºä¾‹](#-ä½¿ç”¨ç¤ºä¾‹)
- [12. `std::io::Result` ä¸ `ErrorKind`](#12-stdioresult-ä¸-errorkind)
  - [âœ… `std::io::Result<T>`](#-stdioresultt)
  - [âœ… `ErrorKind`](#-errorkind)
  - [âœ… å¸¸è§ `ErrorKind`](#-å¸¸è§-errorkind)
- [âœ… æ€»ç»“ï¼šæ ‡å‡†åº“æ–‡ä»¶ç±»å‹å…¨æ™¯å›¾](#-æ€»ç»“æ ‡å‡†åº“æ–‡ä»¶ç±»å‹å…¨æ™¯å›¾)

***

## 1. `std::fs` æ¨¡å—æ¦‚è§ˆ

`std::fs` æ˜¯ Rust æ ‡å‡†åº“ä¸­ç”¨äº**æ–‡ä»¶ç³»ç»Ÿæ“ä½œ**çš„æ¨¡å—ï¼Œæä¾›è·¨å¹³å°çš„æ–‡ä»¶ã€ç›®å½•ã€å…ƒæ•°æ®ç­‰æ“ä½œã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-0" index="0" total="18">use std::fs;</code></pre>

å®ƒæœ¬èº«ä¸å®šä¹‰æ–°ç±»å‹ï¼Œè€Œæ˜¯æä¾›å‡½æ•°å’Œ re-export ä»¥ä¸‹ç±»å‹ï¼š

* `File`
* `OpenOptions`
* `Metadata`
* `Permissions`
* `DirEntry`
* `FileType`

***

## 2. `Path` ä¸ `PathBuf`

### âœ… `Path` â€”â€” ä¸å¯å˜è·¯å¾„å¼•ç”¨

* ç±»å‹ï¼š`&Path`
* ä½œç”¨ï¼šè¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼ˆä¸æ‹¥æœ‰æ•°æ®ï¼‰
* ç±»æ¯”ï¼š`&str` ä¹‹äº `String`

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-1" index="1" total="18">use std::path::Path;

let path: &amp;Path = Path::new("./data/config.json");</code></pre>

### âœ… `PathBuf` â€”â€” å¯å˜è·¯å¾„ï¼ˆæ‹¥æœ‰æ‰€æœ‰æƒï¼‰

* ç±»å‹ï¼š`PathBuf`
* ä½œç”¨ï¼šæ‹¥æœ‰è·¯å¾„æ•°æ®ï¼Œå¯ä¿®æ”¹
* ç±»æ¯”ï¼š`String` ä¹‹äº `&str`

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-2" index="2" total="18">use std::path::PathBuf;

let mut buf: PathBuf = PathBuf::from("./data");
buf.push("logs"); // buf ç°åœ¨æ˜¯ "./data/logs"</code></pre>

### âœ… åˆ›å»ºæ–¹å¼

| æ–¹å¼ | ç¤ºä¾‹ |
|------|------|
| `Path::new(str)` | `Path::new("a/b/c")` |
| `PathBuf::from(str)` | `PathBuf::from("a/b/c")` |
| `format!().into()` | `format!("{}/{}", dir, file).into()` |

### âœ… æ ¸å¿ƒæ–¹æ³•

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `.parent()` | è¿”å›çˆ¶ç›®å½•ï¼ˆ`Option<&Path>`ï¼‰ |
| `.file_name()` | è¿”å›æ–‡ä»¶åï¼ˆ`Option<&OsStr>`ï¼‰ |
| `.file_stem()` | è¿”å›ä¸»æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰ |
| `.extension()` | è¿”å›æ‰©å±•åï¼ˆ`Option<&OsStr>`ï¼‰ |
| `.join(other)` | æ‹¼æ¥è·¯å¾„ï¼Œè¿”å› `PathBuf` |
| `.with_file_name(name)` | æ›¿æ¢æ–‡ä»¶åï¼Œè¿”å› `PathBuf` |
| `.with_extension(ext)` | æ›¿æ¢æ‰©å±•åï¼Œè¿”å› `PathBuf` |
| `.is_absolute()` | æ˜¯å¦ç»å¯¹è·¯å¾„ |
| `.is_relative()` | æ˜¯å¦ç›¸å¯¹è·¯å¾„ |
| `.has_root()` | æ˜¯å¦æœ‰æ ¹ï¼ˆå¦‚ `/` æˆ– `C:\`ï¼‰ |

### âœ… è·¨å¹³å°è¯´æ˜

* `Path` ä¼šè‡ªåŠ¨å¤„ç† `/` å’Œ `\` åˆ†éš”ç¬¦ã€‚
* æ¨èåœ¨ä»£ç ä¸­ä½¿ç”¨ `/`ï¼ŒRust ä¼šè‡ªåŠ¨è½¬æ¢ã€‚

***

## 3. `DirEntry`

è¡¨ç¤ºç›®å½•éå†ä¸­çš„ä¸€ä¸ªæ¡ç›®ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-3" index="3" total="18">use std::fs::read_dir;

for entry in read_dir(".")? {
    let entry: std::io::Result&lt;std::fs::DirEntry&gt; = entry;
    let entry = entry?; // è§£åŒ…
    // ä½¿ç”¨ entry...
}</code></pre>

### âœ… æ ¸å¿ƒæ–¹æ³•

| æ–¹æ³• | è¿”å›ç±»å‹ | è¯´æ˜ |
|------|----------|------|
| `.path()` | `PathBuf` | å®Œæ•´è·¯å¾„ |
| `.file_name()` | `OsString` | æ–‡ä»¶åï¼ˆæ— è·¯å¾„ï¼‰ |
| `.metadata()` | `Result<Metadata>` | è·å–å…ƒæ•°æ®ï¼ˆä¼šç³»ç»Ÿè°ƒç”¨ï¼‰ |
| `.file_type()` | `Result<FileType>` | è·å–æ–‡ä»¶ç±»å‹ï¼ˆæ›´å¿«ï¼‰ |
| `.ino()` | `u64` | inode ç¼–å·ï¼ˆUnixï¼‰ |

> âš ï¸ `.metadata()` å’Œ `.file_type()` éƒ½è¿”å› `Result`ï¼Œå¯èƒ½å¤±è´¥ã€‚

***

## 4. `Metadata`

æ–‡ä»¶æˆ–ç›®å½•çš„å…ƒæ•°æ®ï¼Œé€šè¿‡ `fs::metadata(path)` æˆ– `entry.metadata()` è·å–ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-4" index="4" total="18">let meta = fs::metadata("hello.txt")?;</code></pre>

### âœ… æ ¸å¿ƒæ–¹æ³•

| æ–¹æ³• | è¿”å›ç±»å‹ | è¯´æ˜ |
|------|----------|------|
| `.is_dir()` | `bool` | æ˜¯å¦æ˜¯ç›®å½• |
| `.is_file()` | `bool` | æ˜¯å¦æ˜¯æ–‡ä»¶ |
| `.len()` | `u64` | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| `.permissions()` | `Permissions` | æƒé™ä¿¡æ¯ |
| `.modified()` | `Result<SystemTime>` | æœ€åä¿®æ”¹æ—¶é—´ |
| `.created()` | `Result<SystemTime>` | åˆ›å»ºæ—¶é—´ï¼ˆå¹³å°ç›¸å…³ï¼‰ |
| `.accessed()` | `Result<SystemTime>` | æœ€åè®¿é—®æ—¶é—´ |

> ğŸ“Œ æç¤ºï¼š`metadata()` ä¼šè·Ÿéšç¬¦å·é“¾æ¥ã€‚\
> ä½¿ç”¨ `fs::symlink_metadata()` è·å–ç¬¦å·é“¾æ¥æœ¬èº«çš„å…ƒæ•°æ®ã€‚

***

## 5. `FileType`

è½»é‡çº§æ–‡ä»¶ç±»å‹æ ‡è¯†ï¼Œæ¯” `Metadata` æ›´å¿«ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-5" index="5" total="18">let file_type = entry.file_type()?;</code></pre>

### âœ… æ ¸å¿ƒæ–¹æ³•

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `.is_dir()` | æ˜¯å¦æ˜¯ç›®å½• |
| `.is_file()` | æ˜¯å¦æ˜¯æ–‡ä»¶ |
| `.is_symlink()` | æ˜¯å¦æ˜¯ç¬¦å·é“¾æ¥ |

> âœ… æ¨èåœ¨éå†ç›®å½•æ—¶ä½¿ç”¨ `.file_type()` åˆ¤æ–­ç±»å‹ï¼Œæ€§èƒ½æ›´å¥½ã€‚

***

## 6. `Permissions`

æ–‡ä»¶æƒé™ä¿¡æ¯ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-6" index="6" total="18">let perm = fs::metadata("script.sh")?.permissions();</code></pre>

### âœ… ä¿®æ”¹æƒé™ï¼ˆä»… Unixï¼‰

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-7" index="7" total="18">#[cfg(unix)]
{
    use std::os::unix::fs::PermissionsExt;
    let mut perm = fs::metadata("script.sh")?.permissions();
    PermissionsExt::set_mode(&amp;mut perm, 0o755); // chmod +x
    fs::set_permissions("script.sh", perm)?;
}</code></pre>

> âš ï¸ Windows æƒé™æ¨¡å‹ä¸åŒï¼Œæ ‡å‡†åº“ä¸æä¾›ç»†ç²’åº¦æ§åˆ¶ã€‚

***

## 7. `File`

è¡¨ç¤ºä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-8" index="8" total="18">use std::fs::File;

let file = File::open("read.txt")?;      // åªè¯»æ‰“å¼€
let file = File::create("write.txt")?;   // å†™å…¥ï¼ˆè¦†ç›–ï¼‰</code></pre>

### âœ… å®ç°çš„ Trait

* `Read`ï¼šå¯è¯»
* `Write`ï¼šå¯å†™
* `Seek`ï¼šå¯å®šä½
* `Drop`ï¼šè‡ªåŠ¨å…³é—­ï¼ˆRAIIï¼‰

***

## 8. `OpenOptions`

ç”¨äº**çµæ´»é…ç½®**æ–‡ä»¶æ‰“å¼€æ–¹å¼ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-9" index="9" total="18">use std::fs::OpenOptions;

let file = OpenOptions::new()
    .read(true)
    .write(true)
    .create(true)      // ä¸å­˜åœ¨åˆ™åˆ›å»º
    .append(true)      // è¿½åŠ æ¨¡å¼
    .open("log.txt")?;</code></pre>

### âœ… å¸¸ç”¨é…ç½®

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `.read(bool)` | æ˜¯å¦å¯è¯» |
| `.write(bool)` | æ˜¯å¦å¯å†™ |
| `.append(bool)` | è¿½åŠ æ¨¡å¼ï¼ˆå†™å…¥åˆ°æœ«å°¾ï¼‰ |
| `.truncate(bool)` | æ˜¯å¦æ¸…ç©ºæ–‡ä»¶ï¼ˆé»˜è®¤ trueï¼‰ |
| `.create(bool)` | ä¸å­˜åœ¨æ—¶åˆ›å»º |
| `.create_new(bool)` | åˆ›å»ºæ–°æ–‡ä»¶ï¼ˆå·²å­˜åœ¨åˆ™å¤±è´¥ï¼‰ |

***

## 9. `Read` / `Write` / `Seek` Traits

è¿™ä¸‰ä¸ªæ˜¯ **I/O çš„æ ¸å¿ƒ trait**ï¼Œå®šä¹‰åœ¨ `std::io`ã€‚

### âœ… `Read`

æ‰€æœ‰å¯è¯»ç±»å‹å®ç°ï¼Œå¦‚ `File`, `TcpStream`, `&[u8]`ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-10" index="10" total="18">use std::io::Read;

let mut buffer = [0; 1024];
file.read(&amp;mut buffer)?; // è¯»å–æ•°æ®</code></pre>

#### å¸¸ç”¨æ–¹æ³•

* `.read(&mut buf)` â†’ `Result<usize>`
* `.read_to_end(&mut vec)` â†’ `Result<usize>`
* `.read_to_string(&mut string)` â†’ `Result<usize>`

### âœ… `Write`

æ‰€æœ‰å¯å†™ç±»å‹å®ç°ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-11" index="11" total="18">use std::io::Write;

file.write_all(b"Hello")?; // å†™å…¥æ‰€æœ‰æ•°æ®
file.flush()?;             // åˆ·æ–°ç¼“å†²åŒº</code></pre>

#### å¸¸ç”¨æ–¹æ³•

* `.write(&buf)` â†’ `Result<usize>`
* `.write_all(&buf)` â†’ `Result<()>`ï¼ˆç¡®ä¿å…¨éƒ¨å†™å…¥ï¼‰
* `.flush()` â†’ `Result<()>`

### âœ… `Seek`

ç”¨äºåœ¨æ–‡ä»¶ä¸­å®šä½ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-12" index="12" total="18">use std::io::SeekFrom;

file.seek(SeekFrom::Start(100))?; // è·³åˆ°ç¬¬ 100 å­—èŠ‚
file.seek(SeekFrom::End(-10))?;   // ä»æœ«å°¾å€’æ•°ç¬¬ 10 å­—èŠ‚</code></pre>

***

## 10. `BufReader` / `BufWriter`

æä¾›**ç¼“å†² I/O**ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼Œæå‡æ€§èƒ½ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-13" index="13" total="18">use std::io::{BufReader, BufWriter};

let file = File::open("huge.txt")?;
let mut reader = BufReader::new(file);

let file = File::create("output.txt")?;
let mut writer = BufWriter::new(file);</code></pre>

### âœ… ä¼˜åŠ¿

* è¯»å–æ—¶ï¼šä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨è¯»å–å¤§å—æ•°æ®ï¼Œåç»­ä»å†…å­˜ç¼“å†²è¯»å–ã€‚
* å†™å…¥æ—¶ï¼šæ•°æ®å…ˆå†™å…¥ç¼“å†²ï¼Œç¼“å†²æ»¡æˆ–è°ƒç”¨ `.flush()` æ—¶æ‰å†™å…¥ç£ç›˜ã€‚

***

## 11. `Stdio` ç›¸å…³ç±»å‹

ç”¨äºæ ‡å‡†è¾“å…¥/è¾“å‡º/é”™è¯¯ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-14" index="14" total="18">use std::io::{stdin, stdout, stderr, Stdin, Stdout, Stderr};

let stdin: Stdin = stdin();
let stdout: Stdout = stdout();
let stderr: Stderr = stderr();</code></pre>

### âœ… ä½¿ç”¨ç¤ºä¾‹

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-15" index="15" total="18">use std::io::Write;

writeln!(stdout(), "æ­£å¸¸è¾“å‡º")?;
writeln!(stderr(), "é”™è¯¯è¾“å‡º")?;</code></pre>

***

## 12. `std::io::Result` ä¸ `ErrorKind`

### âœ… `std::io::Result<T>`

æ˜¯ `Result<T, std::io::Error>` çš„ç±»å‹åˆ«åã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-16" index="16" total="18">type Result&lt;T&gt; = std::result::Result&lt;T, std::io::Error&gt;;</code></pre>

æ‰€æœ‰ `fs` å‡½æ•°è¿”å›æ­¤ç±»å‹ã€‚

### âœ… `ErrorKind`

è¡¨ç¤ºé”™è¯¯çš„**ç±»åˆ«**ï¼Œç”¨äºæ¨¡å¼åŒ¹é…ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="97c48d89581242829835b7d16a046b89-17" index="17" total="18">use std::io::{Error, ErrorKind};

match fs::read_to_string("config.json") {
    Ok(content) =&gt; println!("{}", content),
    Err(e) =&gt; match e.kind() {
        ErrorKind::NotFound =&gt; println!("æ–‡ä»¶ä¸å­˜åœ¨"),
        ErrorKind::PermissionDenied =&gt; println!("æ— æƒé™"),
        _ =&gt; return Err(e),
    },
}</code></pre>

### âœ… å¸¸è§ `ErrorKind`

| ç±»å‹ | è¯´æ˜ |
|------|------|
| `NotFound` | æ–‡ä»¶/ç›®å½•ä¸å­˜åœ¨ |
| `PermissionDenied` | æ— æƒé™ |
| `AlreadyExists` | æ–‡ä»¶å·²å­˜åœ¨ |
| `InvalidData` | æ•°æ®æ— æ•ˆï¼ˆå¦‚é UTF-8ï¼‰ |
| `BrokenPipe` | ç®¡é“æ–­å¼€ |
| `WouldBlock` | æ“ä½œä¼šé˜»å¡ï¼ˆéé˜»å¡ I/Oï¼‰ |

***

## âœ… æ€»ç»“ï¼šæ ‡å‡†åº“æ–‡ä»¶ç±»å‹å…¨æ™¯å›¾

| ç±»å‹ | ç”¨é€” | æ‰€åœ¨æ¨¡å— |
|------|------|----------|
| `Path` / `PathBuf` | è·¯å¾„è¡¨ç¤º | `std::path` |
| `DirEntry` | ç›®å½•æ¡ç›® | `std::fs` |
| `Metadata` | æ–‡ä»¶å…ƒæ•°æ® | `std::fs` |
| `FileType` | æ–‡ä»¶ç±»å‹ | `std::fs` |
| `Permissions` | æƒé™ | `std::fs` |
| `File` | æ–‡ä»¶å¥æŸ„ | `std::fs` |
| `OpenOptions` | æ‰“å¼€é…ç½® | `std::fs` |
| `Read` / `Write` / `Seek` | I/O trait | `std::io` |
| `BufReader` / `BufWriter` | ç¼“å†² I/O | `std::io` |
| `Stdin` / `Stdout` / `Stderr` | æ ‡å‡†æµ | `std::io` |
| `Result` / `Error` / `ErrorKind` | é”™è¯¯å¤„ç† | `std::io` |

***

ğŸ¯ **æ ¸å¿ƒæ€æƒ³**ï¼š

Rust æ ‡å‡†åº“é€šè¿‡ **ç»„åˆ** è¿™äº›ç±»å‹å’Œ traitï¼Œå®ç°äº†ï¼š

* **å®‰å…¨æ€§**ï¼ˆ`Result` å¼ºåˆ¶é”™è¯¯å¤„ç†ï¼‰
* **çµæ´»æ€§**ï¼ˆ`OpenOptions`, `BufReader`ï¼‰
* **é«˜æ•ˆæ€§**ï¼ˆç¼“å†²ã€è½»é‡ `FileType`ï¼‰
* **è·¨å¹³å°**ï¼ˆ`Path` è‡ªåŠ¨å¤„ç†åˆ†éš”ç¬¦ï¼‰


# ğŸ¦€ Rust æ ‡å‡†åº“æ–‡ä»¶æ“ä½œ â€”â€” å‡½æ•°ä¸æ–¹æ³•è¶…è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼ˆä»… `std`ï¼‰

> æœ¬æ–‡ **ä»…ä½¿ç”¨ Rust æ ‡å‡†åº“**ï¼Œå¯¹ `std::fs`ã€`std::io`ã€`std::path` ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°å’Œæ–¹æ³•è¿›è¡Œ **è¶…è¯¦ç»†ã€è¶…æ·±å…¥ã€è¶…å®ç”¨** çš„è®²è§£ï¼ŒåŒ…å«å®Œæ•´ç¤ºä¾‹ã€è¾¹ç•Œæƒ…å†µã€é”™è¯¯å¤„ç†å’Œæœ€ä½³å®è·µã€‚

***

## ğŸ“š ç›®å½•

1. [`fs::read` â€”â€” äºŒè¿›åˆ¶æ–‡ä»¶è¯»å–](#1-fsread-â€”â€”-äºŒè¿›åˆ¶æ–‡ä»¶è¯»å–)
2. [`fs::read_to_string` â€”â€” æ–‡æœ¬æ–‡ä»¶è¯»å–](#2-fsread_to_string-â€”â€”-æ–‡æœ¬æ–‡ä»¶è¯»å–)
3. [`fs::write` â€”â€” æ–‡ä»¶å†™å…¥](#3-fswrite-â€”â€”-æ–‡ä»¶å†™å…¥)
4. [`File::open` / `File::create` â€”â€” æ–‡ä»¶æ‰“å¼€](#4-fileopen--filecreate-â€”â€”-æ–‡ä»¶æ‰“å¼€)
5. [`OpenOptions` â€”â€” çµæ´»æ–‡ä»¶æ‰“å¼€](#5-openoptions-â€”â€”-çµæ´»æ–‡ä»¶æ‰“å¼€)
6. [`fs::create_dir` / `create_dir_all` â€”â€” ç›®å½•åˆ›å»º](#6-fscreate_dir--create_dir_all-â€”â€”-ç›®å½•åˆ›å»º)
7. [`fs::read_dir` â€”â€” ç›®å½•éå†](#7-fsread_dir-â€”â€”-ç›®å½•éå†)
8. [`fs::remove_file` / `remove_dir` / `remove_dir_all` â€”â€” åˆ é™¤æ“ä½œ](#8-fsremove_file--remove_dir--remove_dir_all-â€”â€”-åˆ é™¤æ“ä½œ)
9. [`fs::rename` â€”â€” é‡å‘½åä¸ç§»åŠ¨](#9-fsrename-â€”â€”-é‡å‘½åä¸ç§»åŠ¨)
10. [`fs::copy` â€”â€” æ–‡ä»¶å¤åˆ¶](#10-fscopy-â€”â€”-æ–‡ä»¶å¤åˆ¶)
11. [`fs::hard_link` / `symlink` â€”â€” é“¾æ¥æ“ä½œ](#11-fshard_link--symlink-â€”â€”-é“¾æ¥æ“ä½œ)
12. [`fs::metadata` / `symlink_metadata` â€”â€” å…ƒæ•°æ®è·å–](#12-fsmetadata--symlink_metadata-â€”â€”-å…ƒæ•°æ®è·å–)
13. [`fs::set_permissions` â€”â€” æƒé™è®¾ç½®ï¼ˆUnixï¼‰](#13-fsset_permissions-â€”â€”-æƒé™è®¾ç½®unix)
14. [`fs::canonicalize` â€”â€” è·¯å¾„è§„èŒƒåŒ–](#14-fscanonicalize-â€”â€”-è·¯å¾„è§„èŒƒåŒ–)
15. `File` æ–¹æ³•è¯¦è§£ï¼š`sync_all`, `sync_data`, `metadata`
16. `BufReader` / `BufWriter` æ–¹æ³•è¯¦è§£
17. `Read` / `Write` / `Seek` Trait æ–¹æ³•è¯¦è§£

***

## 1. `fs::read` â€”â€” äºŒè¿›åˆ¶æ–‡ä»¶è¯»å–

### âœ… å‡½æ•°ç­¾å

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-0" index="0" total="38">pub fn read&lt;P: AsRef&lt;Path&gt;&gt;(path: P) -&gt; Result&lt;Vec&lt;u8&gt;&gt;</code></pre>

### âœ… åŠŸèƒ½

* ä¸€æ¬¡æ€§è¯»å–æ•´ä¸ªæ–‡ä»¶ä¸º `Vec<u8>`ã€‚
* é€‚ç”¨äº **å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ã€äºŒè¿›åˆ¶æ•°æ®**ã€‚

### âœ… ä½¿ç”¨ç¤ºä¾‹

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-1" index="1" total="38">use std::fs;
use std::path::Path;

// æ–¹å¼1ï¼šç›´æ¥ä¼ å­—ç¬¦ä¸²
let bytes = fs::read("data.bin")?;

// æ–¹å¼2ï¼šä¼  Path
let path = Path::new("data.bin");
let bytes = fs::read(path)?;

// æ–¹å¼3ï¼šä¼  PathBuf
let path_buf = PathBuf::from("data.bin");
let bytes = fs::read(path_buf)?;</code></pre>

### âœ… è¿”å›å€¼

* æˆåŠŸï¼š`Ok(Vec<u8>)`
* å¤±è´¥ï¼š`Err(std::io::Error)`

### âœ… é”™è¯¯å¤„ç†

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-2" index="2" total="38">match fs::read("missing.txt") {
    Ok(bytes) =&gt; println!("è¯»å– {} å­—èŠ‚", bytes.len()),
    Err(e) =&gt; match e.kind() {
        std::io::ErrorKind::NotFound =&gt; println!("æ–‡ä»¶ä¸å­˜åœ¨"),
        std::io::ErrorKind::PermissionDenied =&gt; println!("æ— æƒé™"),
        _ =&gt; println!("å…¶ä»–é”™è¯¯: {}", e),
    },
}</code></pre>

### âœ… è¾¹ç•Œæƒ…å†µ

* **ç©ºæ–‡ä»¶**ï¼šè¿”å› `Ok(vec![])`
* **å¤§æ–‡ä»¶**ï¼šä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ï¼Œå¯èƒ½è€—å°½å†…å­˜ï¼ˆ> GB æ–‡ä»¶æ…ç”¨ï¼‰
* **ç¬¦å·é“¾æ¥**ï¼šè·Ÿéšé“¾æ¥è¯»å–ç›®æ ‡æ–‡ä»¶å†…å®¹

### âœ… æœ€ä½³å®è·µ

* ç”¨äº **å°æ–‡ä»¶**ï¼ˆ< 10MBï¼‰
* å¤§æ–‡ä»¶ä½¿ç”¨ `BufReader` åˆ†å—è¯»å–

***

## 2. `fs::read_to_string` â€”â€” æ–‡æœ¬æ–‡ä»¶è¯»å–

### âœ… å‡½æ•°ç­¾å

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-3" index="3" total="38">pub fn read_to_string&lt;P: AsRef&lt;Path&gt;&gt;(path: P) -&gt; Result&lt;String&gt;</code></pre>

### âœ… åŠŸèƒ½

* ä¸€æ¬¡æ€§è¯»å–æ–‡ä»¶ä¸º `String`ã€‚
* **è¦æ±‚æ–‡ä»¶æ˜¯ UTF-8 ç¼–ç **ã€‚

### âœ… ä½¿ç”¨ç¤ºä¾‹

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-4" index="4" total="38">let content = fs::read_to_string("hello.txt")?;
println!("{}", content);</code></pre>

### âœ… é”™è¯¯å¤„ç†

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-5" index="5" total="38">match fs::read_to_string("binary.bin") {
    Ok(text) =&gt; println!("{}", text),
    Err(e) =&gt; match e.kind() {
        std::io::ErrorKind::InvalidData =&gt; {
            println!("æ–‡ä»¶ä¸æ˜¯æœ‰æ•ˆçš„ UTF-8 æ–‡æœ¬");
        }
        std::io::ErrorKind::NotFound =&gt; println!("æ–‡ä»¶ä¸å­˜åœ¨"),
        _ =&gt; println!("å…¶ä»–é”™è¯¯: {}", e),
    },
}</code></pre>

### âœ… ä¸ `fs::read` çš„é€‰æ‹©

| åœºæ™¯ | æ¨èå‡½æ•° |
|------|----------|
| å›¾ç‰‡ã€éŸ³é¢‘ã€äºŒè¿›åˆ¶ | `fs::read` |
| æ–‡æœ¬ï¼ˆå·²çŸ¥ UTF-8ï¼‰ | `fs::read_to_string` |
| æ–‡æœ¬ï¼ˆç¼–ç ä¸ç¡®å®šï¼‰ | `fs::read` + `String::from_utf8_lossy()` |

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-6" index="6" total="38">let bytes = fs::read("unknown.txt")?;
let text = String::from_utf8_lossy(&amp;bytes); // å®‰å…¨è½¬æ¢</code></pre>

***

## 3. `fs::write` â€”â€” æ–‡ä»¶å†™å…¥

### âœ… å‡½æ•°ç­¾å

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-7" index="7" total="38">pub fn write&lt;P: AsRef&lt;Path&gt;, C: AsRef&lt;[u8]&gt;&gt;(path: P, contents: C) -&gt; Result&lt;()&gt;</code></pre>

### âœ… åŠŸèƒ½

* **è¦†ç›–å†™å…¥** æ–‡ä»¶ã€‚
* è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ã€‚
* è‡ªåŠ¨åˆ›å»ºç›®å½•ï¼ˆ**ä¸è‡ªåŠ¨**ï¼Œéœ€å…ˆåˆ›å»ºç›®å½•ï¼‰ã€‚

### âœ… ä½¿ç”¨ç¤ºä¾‹

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-8" index="8" total="38">// å†™å…¥å­—ç¬¦ä¸²
fs::write("log.txt", "Hello, World!\n")?;

// å†™å…¥å­—èŠ‚åˆ‡ç‰‡
fs::write("data.bin", b"\x00\x01\x02")?;

// å†™å…¥ Vec&lt;u8&gt;
let data = vec![1, 2, 3];
fs::write("data.bin", &amp;data)?;</code></pre>

### âœ… è¦†ç›–è¡Œä¸º

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-9" index="9" total="38">fs::write("file.txt", "ç¬¬ä¸€æ¬¡å†™å…¥")?;
fs::write("file.txt", "ç¬¬äºŒæ¬¡å†™å…¥")?; // ç¬¬ä¸€æ¬¡å†…å®¹è¢«è¦†ç›–</code></pre>

### âœ… è¿½åŠ å†™å…¥ï¼ˆæ ‡å‡†åº“æ— ç›´æ¥å‡½æ•°ï¼‰

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-10" index="10" total="38">use std::fs::OpenOptions;

let mut file = OpenOptions::new()
    .append(true)
    .create(true)
    .open("log.txt")?;
file.write_all(b"æ–°æ—¥å¿—\n")?;</code></pre>

### âœ… é”™è¯¯å¤„ç†

* `PermissionDenied`ï¼šæ— å†™å…¥æƒé™
* `NotFound`ï¼šçˆ¶ç›®å½•ä¸å­˜åœ¨ï¼ˆ`fs::write` ä¸åˆ›å»ºç›®å½•ï¼‰

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-11" index="11" total="38">// å®‰å…¨å†™å…¥ï¼šå…ˆåˆ›å»ºç›®å½•
fs::create_dir_all("logs")?;
fs::write("logs/app.log", "æ—¥å¿—å†…å®¹")?;</code></pre>

***

## 4. `File::open` / `File::create` â€”â€” æ–‡ä»¶æ‰“å¼€

### âœ… `File::open<P: AsRef<Path>>(path: P) -> Result<File>`

* **åªè¯»** æ‰“å¼€æ–‡ä»¶ã€‚
* æ–‡ä»¶ä¸å­˜åœ¨ â†’ `NotFound`

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-12" index="12" total="38">let file = File::open("read.txt")?;</code></pre>

### âœ… `File::create<P: AsRef<Path>>(path: P) -> Result<File>`

* **å†™å…¥** æ‰“å¼€æ–‡ä»¶ã€‚
* **è¦†ç›–** åŸå†…å®¹ã€‚
* è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-13" index="13" total="38">let file = File::create("write.txt")?;</code></pre>

### âœ… ä¸¤è€…å¯¹æ¯”

| è¡Œä¸º | `File::open` | `File::create` |
|------|--------------|----------------|
| æ–‡ä»¶ä¸å­˜åœ¨ | å¤±è´¥ | åˆ›å»º |
| æ–‡ä»¶å­˜åœ¨ | æ‰“å¼€ï¼ˆä¸ä¿®æ”¹ï¼‰ | è¦†ç›–ï¼ˆæ¸…ç©ºï¼‰ |
| æ¨¡å¼ | åªè¯» | å¯å†™ï¼ˆé€šå¸¸å¯è¯»ï¼‰ |

> âš ï¸ `File::create` åˆ›å»ºçš„æ–‡ä»¶é€šå¸¸ä¹Ÿå¯è¯»ï¼Œä½†ä¸ä¿è¯ã€‚

***

## 5. `OpenOptions` â€”â€” çµæ´»æ–‡ä»¶æ‰“å¼€

### âœ… ä½¿ç”¨åœºæ™¯

å½“ `File::open` å’Œ `File::create` æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œä½¿ç”¨ `OpenOptions`ã€‚

### âœ… å®Œæ•´ç¤ºä¾‹ï¼šè¿½åŠ æ¨¡å¼

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-14" index="14" total="38">use std::fs::OpenOptions;

let file = OpenOptions::new()
    .read(true)          // å¯è¯»
    .write(true)         // å¯å†™
    .append(true)        // è¿½åŠ ï¼ˆå†™å…¥åˆ°æœ«å°¾ï¼‰
    .create(true)        // ä¸å­˜åœ¨åˆ™åˆ›å»º
    .open("log.txt")?;   // è¿”å› File</code></pre>

### âœ… ç¤ºä¾‹ï¼šåªå†™æ¨¡å¼ï¼ˆä¸è¯»ï¼‰

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-15" index="15" total="38">let file = OpenOptions::new()
    .write(true)
    .truncate(true)      // æ¸…ç©º
    .create(true)
    .open("output.txt")?;</code></pre>

### âœ… ç¤ºä¾‹ï¼šåŸå­æ€§åˆ›å»ºæ–°æ–‡ä»¶

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-16" index="16" total="38">let file = OpenOptions::new()
    .write(true)
    .create_new(true)    // å·²å­˜åœ¨åˆ™å¤±è´¥
    .open("temp.txt")?;  // ç¡®ä¿ä¸ä¼šè¦†ç›–</code></pre>

### âœ… æ–¹æ³•é“¾è¯´æ˜

| æ–¹æ³• | ä½œç”¨ |
|------|------|
| `.read(bool)` | è®¾ç½® `O_RDONLY` |
| `.write(bool)` | è®¾ç½® `O_WRONLY` |
| `.append(bool)` | è®¾ç½® `O_APPEND` |
| `.truncate(bool)` | è®¾ç½® `O_TRUNC`ï¼ˆå†™å…¥æ—¶æ¸…ç©ºï¼‰ |
| `.create(bool)` | è®¾ç½® `O_CREAT` |
| `.create_new(bool)` | è®¾ç½® `O_CREAT \| O_EXCL`ï¼ˆåŸå­åˆ›å»ºï¼‰ |

***

## 6. `fs::create_dir` / `create_dir_all` â€”â€” ç›®å½•åˆ›å»º

### âœ… `fs::create_dir<P: AsRef<Path>>(path: P) -> Result<()>`

* åˆ›å»º**å•å±‚**ç›®å½•ã€‚
* çˆ¶ç›®å½•å¿…é¡»å­˜åœ¨ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-17" index="17" total="38">// æˆåŠŸ
fs::create_dir("logs")?;

// å¤±è´¥ï¼šçˆ¶ç›®å½• a ä¸å­˜åœ¨
fs::create_dir("a/b/c")?; // Error: NotFound</code></pre>

### âœ… `fs::create_dir_all<P: AsRef<Path>>(path: P) -> Result<()>`

* åˆ›å»º**å¤šå±‚**ç›®å½•ã€‚
* æ¨èä½¿ç”¨ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-18" index="18" total="38">fs::create_dir_all("a/b/c")?; // è‡ªåŠ¨åˆ›å»º a, a/b, a/b/c</code></pre>

### âœ… å®‰å…¨æ€§

* å¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œ`create_dir_all` è¿”å› `Ok(())`ï¼Œ**ä¸æŠ¥é”™**ã€‚
* `create_dir` åœ¨ç›®å½•å­˜åœ¨æ—¶è¿”å› `ErrorKind::AlreadyExists`ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-19" index="19" total="38">fs::create_dir_all("existing_dir")?; // OK
fs::create_dir("existing_dir")?;     // Error: AlreadyExists</code></pre>

***

## 7. `fs::read_dir` â€”â€” ç›®å½•éå†

### âœ… å‡½æ•°ç­¾å

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-20" index="20" total="38">pub fn read_dir&lt;P: AsRef&lt;Path&gt;&gt;(path: P) -&gt; Result&lt;ReadDir&gt;</code></pre>

### âœ… è¿”å›ç±»å‹

* `ReadDir`ï¼šä¸€ä¸ªè¿­ä»£å™¨ï¼Œäº§ç”Ÿ `Result<DirEntry>`
* æ¯ä¸ªæ¡ç›®éƒ½å¯èƒ½å‡ºé”™ï¼ˆå¦‚æƒé™ä¸è¶³ï¼‰

### âœ… å®Œæ•´ç¤ºä¾‹

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-21" index="21" total="38">use std::fs;
use std::path::Path;

let path = Path::new(".");

for entry_result in fs::read_dir(path)? {
    let entry = entry_result?; // å¤„ç† DirEntry é”™è¯¯
    let file_name = entry.file_name(); // OsString
    let file_name_str = file_name.to_string_lossy(); // è½¬ä¸º String
    let metadata = entry.metadata()?; // è·å–å…ƒæ•°æ®
    let file_size = metadata.len();

    println!("{:&gt;8} {}", file_size, file_name_str);
}</code></pre>

### âœ… æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ `file_type`

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-22" index="22" total="38">// æ¨èï¼šä½¿ç”¨ file_type()ï¼Œä¸è§¦å‘ç³»ç»Ÿè°ƒç”¨
for entry in fs::read_dir(".")? {
    let entry = entry?;
    if entry.file_type()?.is_dir() {
        println!("ç›®å½•: {:?}", entry.file_name());
    }
}

// ä¸æ¨èï¼šmetadata() è§¦å‘ç³»ç»Ÿè°ƒç”¨
for entry in fs::read_dir(".")? {
    let entry = entry?;
    if entry.metadata()?.is_dir() { // å¤šä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨
        println!("ç›®å½•: {:?}", entry.file_name());
    }
}</code></pre>

***

## 8. `fs::remove_file` / `remove_dir` / `remove_dir_all` â€”â€” åˆ é™¤æ“ä½œ

### âœ… `fs::remove_file<P: AsRef<Path>>(path: P) -> Result<()>`

* åˆ é™¤**æ–‡ä»¶**ã€‚
* ä¸èƒ½åˆ é™¤ç›®å½•ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-23" index="23" total="38">fs::remove_file("temp.txt")?;</code></pre>

### âœ… `fs::remove_dir<P: AsRef<Path>>(path: P) -> Result<()>`

* åˆ é™¤**ç©ºç›®å½•**ã€‚
* ç›®å½•éç©º â†’ `ErrorKind::DirectoryNotEmpty`

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-24" index="24" total="38">fs::remove_dir("empty_dir")?;</code></pre>

### âœ… `fs::remove_dir_all<P: AsRef<Path>>(path: P) -> Result<()>`

* **é€’å½’åˆ é™¤** ç›®å½•åŠå…¶æ‰€æœ‰å†…å®¹ã€‚
* éå¸¸å±é™©ï¼Œä¸å¯é€†ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-25" index="25" total="38">fs::remove_dir_all("temp_data")?; // åˆ é™¤æ•´ä¸ªç›®å½•æ ‘</code></pre>

### âœ… é”™è¯¯å¤„ç†

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-26" index="26" total="38">match fs::remove_dir("non_empty") {
    Ok(()) =&gt; println!("åˆ é™¤ç©ºç›®å½•æˆåŠŸ"),
    Err(e) =&gt; match e.kind() {
        std::io::ErrorKind::DirectoryNotEmpty =&gt; {
            println!("ç›®å½•éç©ºï¼Œæ— æ³•åˆ é™¤");
        }
        std::io::ErrorKind::NotFound =&gt; println!("ç›®å½•ä¸å­˜åœ¨"),
        _ =&gt; println!("å…¶ä»–é”™è¯¯: {}", e),
    },
}</code></pre>

***

## 9. `fs::rename` â€”â€” é‡å‘½åä¸ç§»åŠ¨

### âœ… å‡½æ•°ç­¾å

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-27" index="27" total="38">pub fn rename&lt;P: AsRef&lt;Path&gt;, Q: AsRef&lt;Path&gt;&gt;(from: P, to: Q) -&gt; Result&lt;()&gt;</code></pre>

### âœ… åŠŸèƒ½

* é‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚
* ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ï¼ˆåŒä¸€æ–‡ä»¶ç³»ç»Ÿå†…æ˜¯åŸå­æ“ä½œï¼‰ã€‚

### âœ… ä½¿ç”¨ç¤ºä¾‹

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-28" index="28" total="38">// é‡å‘½å
fs::rename("old.txt", "new.txt")?;

// ç§»åŠ¨
fs::rename("src/file.txt", "dst/file.txt")?;

// ç§»åŠ¨ç›®å½•
fs::rename("src/", "backup/")?;</code></pre>

### âœ… åŸå­æ€§

* **åŒä¸€æ–‡ä»¶ç³»ç»Ÿå†…**ï¼š`rename` æ˜¯åŸå­æ“ä½œï¼ˆä¸ä¼šå‡ºç°â€œåªç§»åŠ¨ä¸€åŠâ€ï¼‰ã€‚
* **è·¨æ–‡ä»¶ç³»ç»Ÿ**ï¼šå¯èƒ½é€€åŒ–ä¸ºâ€œå¤åˆ¶ + åˆ é™¤â€ï¼ŒéåŸå­ã€‚

### âœ… é”™è¯¯å¤„ç†

* `AlreadyExists`ï¼šç›®æ ‡å·²å­˜åœ¨
* `NotFound`ï¼šæºä¸å­˜åœ¨
* `PermissionDenied`ï¼šæ— æƒé™

***

## 10. `fs::copy` â€”â€” æ–‡ä»¶å¤åˆ¶

### âœ… å‡½æ•°ç­¾å

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-29" index="29" total="38">pub fn copy&lt;P: AsRef&lt;Path&gt;, Q: AsRef&lt;Path&gt;&gt;(from: P, to: Q) -&gt; Result&lt;u64&gt;</code></pre>

### âœ… åŠŸèƒ½

* å¤åˆ¶æ–‡ä»¶ã€‚
* è¿”å›å¤åˆ¶çš„**å­—èŠ‚æ•°**ã€‚
* è‡ªåŠ¨åˆ›å»ºç›®æ ‡æ–‡ä»¶ã€‚
* **ä¸å¤åˆ¶ç›®å½•**ã€‚

### âœ… ä½¿ç”¨ç¤ºä¾‹

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-30" index="30" total="38">let bytes_copied = fs::copy("source.txt", "backup.txt")?;
println!("å¤åˆ¶äº† {} å­—èŠ‚", bytes_copied);</code></pre>

### âœ… æƒé™ä¿ç•™ï¼ˆUnixï¼‰

* åœ¨ Unix ç³»ç»Ÿä¸Šï¼Œå¤åˆ¶çš„æ–‡ä»¶**ä¿ç•™åŸæƒé™**ï¼ˆå¦‚å¯æ‰§è¡Œä½ï¼‰ã€‚

### âœ… ä¸ `rename` å¯¹æ¯”

| æ“ä½œ | `fs::rename` | `fs::copy` |
|------|--------------|------------|
| ç§»åŠ¨/é‡å‘½å | âœ… | âŒ |
| å¤åˆ¶ | âŒ | âœ… |
| åŸå­æ€§ | åŒä¸€æ–‡ä»¶ç³»ç»Ÿå†…æ˜¯ | å¦ |
| ç›®å½• | âœ… | âŒ |

***

## 11. `fs::hard_link` / `symlink` â€”â€” é“¾æ¥æ“ä½œ

### âœ… `fs::hard_link<P: AsRef<Path>, Q: AsRef<Path>>(src: P, dst: Q) -> Result<()>`

* åˆ›å»º**ç¡¬é“¾æ¥**ã€‚
* å…±äº« inodeã€‚
* ä¸èƒ½è·¨æ–‡ä»¶ç³»ç»Ÿï¼Œä¸èƒ½é“¾æ¥ç›®å½•ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-31" index="31" total="38">fs::hard_link("original.txt", "link.txt")?;</code></pre>

### âœ… `fs::symlink<P: AsRef<Path>, Q: AsRef<Path>>(src: P, dst: Q) -> Result<()>`

* åˆ›å»º**ç¬¦å·é“¾æ¥**ï¼ˆè½¯é“¾æ¥ï¼‰ã€‚
* å¯ä»¥è·¨æ–‡ä»¶ç³»ç»Ÿã€‚
* Windows éœ€è¦ç‰¹æ®Šæƒé™ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-32" index="32" total="38">fs::symlink("target.txt", "link.txt")?;</code></pre>

### âœ… åˆ¤æ–­é“¾æ¥ç±»å‹

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-33" index="33" total="38">let meta = fs::symlink_metadata("link.txt")?;
if meta.file_type().is_symlink() {
    println!("æ˜¯ç¬¦å·é“¾æ¥");
}</code></pre>

***

## 12. `fs::metadata` / `symlink_metadata` â€”â€” å…ƒæ•°æ®è·å–

### âœ… `fs::metadata<P: AsRef<Path>>(path: P) -> Result<Metadata>`

* è·å–æ–‡ä»¶/ç›®å½•å…ƒæ•°æ®ã€‚
* **è·Ÿéšç¬¦å·é“¾æ¥**ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-34" index="34" total="38">let meta = fs::metadata("file.txt")?;
println!("å¤§å°: {} å­—èŠ‚", meta.len());</code></pre>

### âœ… `fs::symlink_metadata<P: AsRef<Path>>(path: P) -> Result<Metadata>`

* è·å–**ç¬¦å·é“¾æ¥æœ¬èº«**çš„å…ƒæ•°æ®ã€‚
* **ä¸è·Ÿéš**ã€‚

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-35" index="35" total="38">let meta = fs::symlink_metadata("link.txt")?;
if meta.file_type().is_symlink() {
    println!("è¿™æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥");
}</code></pre>

***

## 13. `fs::set_permissions` â€”â€” æƒé™è®¾ç½®ï¼ˆUnixï¼‰

### âœ… ä»…é™ Unix

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-36" index="36" total="38">#[cfg(unix)]
{
    use std::os::unix::fs::PermissionsExt;
    use std::fs;

    let mut perm = fs::metadata("script.sh")?.permissions();
    PermissionsExt::set_mode(&amp;mut perm, 0o755); // rwxr-xr-x
    fs::set_permissions("script.sh", perm)?;
}</code></pre>

***

## 14. `fs::canonicalize` â€”â€” è·¯å¾„è§„èŒƒåŒ–

<pre style="background: none"><code class="language-rust" data-language="rust" identifier="e5aa7a19182d403584272a17d0b57858-37" index="37" total="38">let abs = fs::canonicalize("../dir/../file.txt")?;
// è¿”å›ç»å¯¹è·¯å¾„ï¼Œè§£æ .. å’Œ .</code></pre>

> â— è·¯å¾„å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™è¿”å› `NotFound`ã€‚

***

ğŸ¯ **ç»“è¯­**ï¼š\
è¿™ä»½æŒ‡å—è¦†ç›–äº† **Rust æ ‡å‡†åº“æ–‡ä»¶æ“ä½œçš„æ‰€æœ‰å‡½æ•°ä¸æ–¹æ³•**ï¼Œä»ç­¾åã€ç”¨æ³•ã€ç¤ºä¾‹åˆ°é”™è¯¯å¤„ç†å’Œæœ€ä½³å®è·µï¼Œ**æ— æ‰€ä¸åŒ…**ã€‚\
æ”¶è—å®ƒï¼Œä½ å°†æ‹¥æœ‰ä¸€ä¸ª **æœ€å…¨ã€æœ€ç»†ã€æœ€å®ç”¨** çš„ Rust æ–‡ä»¶æ“ä½œå‚è€ƒæ‰‹å†Œã€‚
